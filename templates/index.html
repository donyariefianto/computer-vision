<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyAV Multi-Process Monitoring</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        .status-running { color: green; font-weight: bold; }
        .status-stopped { color: red; font-weight: bold; }
        .log-container { height: 200px; overflow-y: auto; background-color: #212529; color: #f8f9fa; padding: 10px; border-radius: 5px; }
        .process-card { margin-bottom: 20px; border: 1px solid #ccc; border-radius: 8px; padding: 15px; }
    </style>
</head>
<body>

    <div class="container py-5">
        <h2 class="text-center mb-4">ðŸŽ¥ PyAV Multi-Process Monitoring</h2>

        <!-- FORM: Start Process -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h5 class="card-title">Start New Process</h5>
                <div class="mb-3">
                    <input type="text" class="form-control" id="process_id" placeholder="Process ID (unik)">
                </div>
                <div class="mb-3">
                    <input type="text" class="form-control" id="video_path" placeholder="Path video (mp4, RTSP, dll)">
                </div>
                <button class="btn btn-success" onclick="startProcess()">Start Process</button>
            </div>
        </div>

        <!-- Active Processes -->
        <h4>Active Processes:</h4>
        <div id="process-list"></div>

        <!-- Log Viewer -->
        <h4 class="mt-5">Log Viewer:</h4>
        <div class="log-container" id="logs">Pilih proses untuk melihat log...</div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function startProcess() {
            let processId = $("#process_id").val();
            let videoPath = $("#video_path").val();

            if (!processId || !videoPath) {
                alert("âš ï¸ Process ID dan Video Path wajib diisi.");
                return;
            }

            $.post("/start/", { process_id: processId, video_path: videoPath }, function(response) {
                loadProcesses();
                $("#process_id").val('');
                $("#video_path").val('');
            });
        }

        function stopProcess(processId) {
            $.post("/stop/", { process_id: processId }, function(response) {
                loadProcesses();
            });
        }

        function loadProcesses() {
            $.get("/processes/", function(response) {
                let html = "";
                response.forEach(proc => {
                    html += `
                        <div class="process-card">
                            <h5>ðŸ†” ${proc.process_id}</h5>
                            <p>Status: <span class="${proc.status === 'running' ? 'status-running' : 'status-stopped'}">${proc.status}</span></p>
                            <p>Started At: ${proc.start_time}</p>
                            <p>Frames Processed: ${proc.frame_count}</p>
                            <button class="btn btn-danger btn-sm" onclick="stopProcess('${proc.process_id}')">Stop</button>
                            <button class="btn btn-info btn-sm ms-2" onclick="loadLogs('${proc.process_id}')">View Logs</button>
                        </div>
                    `;
                });
                $("#process-list").html(html);
            });
        }

        function loadLogs(processId) {
            $.get("/logs/?process_id=" + processId, function(response) {
                $("#logs").html(response.logs.join("<br>"));
            });
        }

        // Auto-refresh setiap 5 detik
        setInterval(loadProcesses, 5000);
    </script>

</body>
</html>
